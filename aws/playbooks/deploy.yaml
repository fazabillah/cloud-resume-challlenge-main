---
- name: Deploy CloudFormation Stack
  hosts: localhost
  connection: local
  gather_facts: false

  vars_files:
    - vaults/prod.yaml

  vars:
    stack_name: cloud-resume-s3-stack
    bucket_name: resume-fazabillah
    domain_name: fazabillah.com

  tasks:
    - name: Deploy CloudFormation stack
      amazon.aws.cloudformation:
        stack_name: "{{ stack_name }}"
        state: present
        region: "{{ aws_region }}"
        template: "../frontend.yaml"
        template_parameters:
          BucketName: "{{ bucket_name }}"
          DomainName: "{{ domain_name }}"
        capabilities:
          - CAPABILITY_IAM
        aws_access_key_id: "{{ aws_access_key_id }}"
        aws_secret_access_key: "{{ aws_secret_access_key }}"
      register: stack_output

    - name: Display deployment results
      ansible.builtin.debug:
        msg:
          - "=========================================="
          - "âœ… Stack Deployed Successfully!"
          - "=========================================="
          - ""
          - "ğŸ“¦ S3 Bucket: {{ stack_output.stack_outputs.BucketName }}"
          - "ğŸŒ CloudFront ID: {{ stack_output.stack_outputs.CloudFrontDistributionId }}"
          - "ğŸ”— CloudFront Domain: {{ stack_output.stack_outputs.CloudFrontDomainName }}"
          - "ğŸŒ Website URL: {{ stack_output.stack_outputs.WebsiteURL }}"